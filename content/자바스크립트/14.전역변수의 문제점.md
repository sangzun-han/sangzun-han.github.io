---
emoji: 
title: 14. 전역변수의 문제점
date: '2021-11-30 17:30:00'
author: sangzun
tags: 자바스크립트
categories: javascript
---

# 1. 변수의 생명주기

### 1-1. 지역변수의 생명주기

변수는 선언에 의해 생성되고 할당을 통해 값을 갖는다. 그리고 언젠가 소멸한다. 즉 변수는 생명주기(Life Cycle)가 있다. 변수에 생명주기가 없다면 한번 선언된 변수는 영원히 메모리 공간을 점유하게 된다.
***지역변수의 생명주기는 함수의 생명주기와 일치한다.***

변수의 생명주기는 메모리 공간이 확보(allocate)된 시점부터 메모리 공간이 해제(release)되어 가용 메모리풀(memory pool)에 반환되는 시점까지다.

함수 내부에서 선언된 지역 변수는 함수가 생성한 스코프에 등록된다. 할당된 메모리 공간은 더 이상 그 누구도 참조하지 않을 때 가비지 콜렉터에 의해 해제되어 가용 메모리 풀에 반환된다. 즉 누군가 메모리 공간을 참조하고 있으면 해제되지 않고 확보된 상태로 남아 있게 된다. 마찬가지로 누군가 스코프를 참조하고 있으면 스코프는 소멸하지 않고 생존하게 된다.

### 1-2. 전역변수의 생명주기

전역코드는 명시적인 호출없이 실행된다. 전역코드에는 반환문을 사용할 수 없으므로 마지막문이 실행되어 더 이상 실행할 문이 없을 때 종료된다.

var키워드로 선언된 전역변수는 전역 객체의 프로퍼티가 된다. 따라서 var 키워드로 선언된 전역변수의 생명주기는 전역 객체의 생명주기와 일치한다.

# 2. 전역변수의 문제점

1. 암묵적 결합(implic coupling) : 전역코드는 어디서든 참조하고 할당할 수 있는 변수이다. 변수의 유효범위가 크고 가독성이 나빠지고 의도치 않게 상태가 변경될 수 있는 위험성이 존재한다.

2. 긴 생명 주기 : 전역변수는 생명주기가 길다. 따라서 메모리 리소스도 오랜기간 소비한다. 또한 전역변수의 상태를 변경할 수 있는 시간도 길고 기회도 
많다.

3. 스코프 체인 상에서 종점에 존재 : 변수를 검색 할 때 전역 변수가 가장 마지막에 검색되므로 검색속도가 느리다.

4. 네임스페이스 오염 : 자바스크립트는 파일이 분리되어 있다해도 하나의 전역스코프를 공유한다. 따라서 다른 파일 내에서 동일한 이름으로 명명된 전역변수나 전역함수가 같은 스코프 내에 존재할 경우 예상치 못한 결과를 가져올 수 있다.

# 3. 전역변수 사용을 억제하는 방법

1. 즉시 실행 함수

함수정의와 동시에 동시에 호출되는 즉시 실행 함수는 단 한번만 호출된다. 모든 코드를 즉시 실행 함수로 감싸면 모든 변수는 즉시 실행 함수의 지역변수가 된다.

```
(function() {
  var foo = 10;
}());
```

2. 네임스페이스 객체

전역에 네임스페이스 역할을 담당할 객체를 생성하고 전역변수처럼 사용하고싶은 변수를 프로퍼티로 추가한다.

```
var MYAPP = {};
MYAPP.name = 'Haa';
```

3. 모듈 패턴

클래스를 모방해서 관련이 있는 변수와 함수를 모아 즉시 실행 함수로 감싸 하나의 모듈을 만든다. 전역변수의 억제느 물론 캡슐화 까지 구현할 수 있다.

```
var Counter = (function() {
  // private
  var num = 0;

  return (
    increase() {
      return ++num;
    },
    decrease() {
      return --num;
    }
}());
```

4. ES6 모듈

ES6모듈을 사용하면 전역변수를 사용할 수 없다. ES6모듈은 파일 자체의 독자적인 모듈스코프를 제공한다.

```
<script type="module" src="test.mjs"></script>
```